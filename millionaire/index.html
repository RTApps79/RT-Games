<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radiobiology: Millionaire Challenge</title>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;400;600;900&display=swap');

        html, body {
            margin: 0;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            font-family: 'Poppins', sans-serif;
            background: rgb(20,16,42);
            background: linear-gradient(126deg, rgba(20,16,42,1) 0%, rgba(49,83,162,1) 51%, rgba(35,33,165,1) 100%);
        }

        #splash {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: fixed;
            width: 100%;
            height: 100%;
            z-index: 3;
        }

        .split {
            position: absolute;
            top: 0;
            width: 50%;
            height: 100%;
            overflow: hidden;
            background-color: black;
            transition-delay: 1s;
            transition-duration: 1s;
        }

        .sRight {
            right: 0;
            background: #310531;
        }

        .sLeft {
            left: 0;
            background: #310531;
        }

        .centralContent {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 500px;
            max-width: 80%;
            height: 500px;
            z-index: 3;
            -webkit-animation-delay: 0.2s;
            animation-delay: 0.2s;
            cursor: unset !important;
            border: 20px solid #00B4EA;
            background: #310531;
            color: white;
            position: relative;
            text-align: center;
            border-radius: 100%;
            box-shadow: #310531 1px 1px 10px;
        }

        .splashBox {
            margin-bottom: 20px;
        }

        .centralContent h1 {
            position: relative;
            font-size: 28px;
            max-width: 80%;
            text-align: center;
            margin: auto;
            z-index: 2;
            color: gold;
        }


        .centralContent h2 {
            margin: 0 10px;
            font-weight: 600;
            z-index: 4;
        }

        .centralContent h4 {
            margin: 0 10px 10px;
            font-weight: 600;
            z-index: 4;
        }

        .centralContent p {
            max-width: 80%;
            text-align: center;
            margin: 10px;
        }

        #soundSelect {
            margin: 10px 10px 20px;
            background: var(--primary);
            padding: 10px 30px;
            border: 3px solid white;
            border-radius: 100px;
        }

        #soundSelect span {
            cursor: pointer;
            font-weight: 600;
        }

        #soundSelect span.chosen {
            border-bottom: 2px solid white;
        }

        .animateLeft {
            left: -150vh;
        }

        .animateRight {
            right: -150vh;
        }

        #game {
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: stretch;
            margin: auto;
            height: 100vh;
        }

        #progressBoard {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 0 20px;
            color: orange;
            font-weight: 600;
            height: calc(100% - 3px);
        }

        #lifeLines {
            display: flex;
            flex-direction: column;
            width: 200px;
            text-align: center;
        }

        .lifeLine {
            flex: 1 1 auto;
            margin: 0 5px 10px;
            border: 2px solid white;
            padding: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .lifeLine:hover {
            background: #1f47c5;
        }

        #progressList {
            display: flex;
            flex-direction: column;
        }

        .progress {
            display: none;
            padding: 5px;
        }

        .progress.safe {
            color: white;
        }

        .qNum {
            display: flex;
            width: 40px;
        }

        .qNum:after {
            content: '';
            display: flex;
            justify-content: center;
            align-items: center;
            width: 10px;
            color: white;
            margin-left: 10px;
        }

        .progress.answered .qNum:after {
            content: '✔';
        } 

        #questionsBoard {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: calc(100% - 20px);
            padding: 10px;
            background: white;
        }

        .questions {
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .question {
            display: flex;
            justify-content: center;
            align-items: center;
            width: calc(100% - 40px);
            padding: 10px;
            background: rgb(12,12,113);
            background: linear-gradient(270deg, rgba(12,12,113,1) 0%, rgba(6,41,143,1) 50%, rgba(12,12,113,1) 100%);
            color: white;
        }

        #answers {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            padding: 10px;
            width: calc(100%);
        }

        .answer {
            flex: calc(50% - 40px);
            display: flex;
            margin: 10px;
            background: rgb(9,45,158);
            padding: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .answer:hover {
            background: #1f47c5;            
        }

        .questionLetter {
            font-weight: 600;
        }

        .correctAnswer, .answerType, .answerTypeNumber {
            display: none;
        }

        .disabled {
            pointer-events: none;
            background: grey;
            color: darkgray;
        }

        .clicked {
            background: #1f47c5;
        }

        .right {
            background: orange !important;
            color: black;
            pointer-events: none;
        }

        .wrong {
            background: black;
        }        

        #infoPanel {
            margin: 10px;
            max-width: 600px;
            text-align: center;
        }

        .potentialPrize {
            display: initial;
            color: orange;
            font-weight: 600;
        }

        #askAudienceBG, #phoneAfriendBG {
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            display: none;
            flex-direction: column;
        }

        #askAudienceBG .close, #phoneAfriendBG .close {
            position: absolute;
            display: flex;
            top: 20px;
            right: 20px;
            width: 30px;
            height: 30px;
            justify-content: center;
            align-items: center;
            border: 1px solid white;
            color: white;
            font-size: 31px;
            cursor: pointer;
            transition: all 0.3s;
        }

        #askAudienceBG .close:hover, #phoneAfriendBG .close:hover {
            transform: scale(1.1);
            background: white;
            color: #081c81;
        }

        #askAudience, #phoneAfriend {
            display: flex;
            flex-direction: row;
            justify-content: space-around;
            color: white;
            width: 80%;
            max-width: 1000px;
            min-height: 60%;
            padding: 20px;
            background: rgb(12, 12, 113);
            background: linear-gradient(270deg, rgba(12, 12, 113, 1) 0%, rgba(6, 41, 143, 1) 50%, rgba(12, 12, 113, 1) 100%);
            border: 1px solid white;
            position: relative;
            z-index: 2;
        }

        #phoneAfriend {
            align-items: center;
            flex-direction: column;
            justify-content: center;
        }

        #askAudience:before, #phoneAfriend:before {
            content: "";
            position: absolute;
            top: 0; 
            left: 0;
            width: 100%; 
            height: 100%;  
            opacity: .1; 
            z-index: -1;
            background-size: cover;
        }

        #askAudience:before {
            background-image: url(https://mwaistell.site/projects/WhoWantsToBeAMillionaire/audience.jpg);

        }

        #phoneAfriend:before {
            background-image: url(https://mwaistell.site/projects/WhoWantsToBeAMillionaire/phoneFriend.jpg);

        }

        #phoneAfriend p, #phoneAfriend ul {
            font-size: 14px;
        }

        #phoneAfriend li {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }

        .aaQ {
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
            margin: 0 10px;
            padding: 10px 20px;
        }

        .aaBarContainer {
            display: flex;
            height: 100%;
            min-width: 20px;
            align-items: flex-end;
            border: 2px solid white;
        }

        .aaQ .percentage:after {
            content: '%';
        }

        .aaBars {
            background: white;
            height: 0;
            width: 100%;
            border: 1px solid #081c81;
            transition: all 1s;
        }

        .friends {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px;
        }

        .friend {
            display: flex;
            width: calc(33.33% - 34px);
            padding: 5px 10px;
            margin: 5px;
            justify-content: center;
            align-items: center;
            border: 2px solid;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 12px;
        }

        .friend:hover {
            background: white;
            color: #081c81;
        }

        .fName {
            text-align: center;
        }

        .fTypeNumber {
            display: none;
        }

        .friendInfo {
            display: flex;
        }

        .fAnswer {
            margin: 0 5px;
            font-weight: 600;
        }

        .friendsAnswer {
            border: 2px solid orange;
            flex: calc(50% - 44px) !important;
        }

        .friend.selected {
            color: black;
        }

        .ident {
            padding: 7px;
            margin-right: 10px;
        }

        .ident1 {
            background: #5eab5e;
        }

        .ident2 {
            background: #bb9f0f;
        }

        .ident3 {
            background: #af3a3a;
        }

        .clickedCorrect {
            background: #5eab5e !important;
        }        

        .clicked5050 {
            background: #bb9f0f !important;
        }

        .clickedWrong {
            background: #af3a3a !important;
        }

        .next, .restart, #playButton, .closeButton {
            display: flex;
            border: 1px solid #081c81;
            background: white;
            padding: 5px 20px;
            margin: 10px auto;
            transition: all 0.3s;
            cursor: pointer;
            font-family: inherit;
            font-size: 16px;
        }

        .closeButton {
            display: none;
            color: #081c81;
        }

        .next:hover {
            background: #081c81;
            color: white;
        }

        .leaveWith {
            margin: 0 5px;
            font-size: 20px;
            font-weight: 600;
        }

        #takeTheMoney {
            display: none;
            border: 1px solid #081c81;
            padding: 5px 20px;
            margin: 10px 10px 20px;
            transition: all 0.3s;
            cursor: pointer;
        }

        #takeTheMoney:hover {
            background: #081c81;
            color: white;
        }

        #infoPanel.bigTakeover {
            width: calc(100% - 40px);
            justify-content: center;
            background: orange;
            flex-direction: column;
            padding: 20px;
        }

        #infoPanel.bigTakeover .leaveWith {
            margin: 0 5px;
            font-weight: 600;
            font-size: 26px;
        }

        #infoPanel.bigTakeover .potentialPrize {
            display: flex;
            background: white;
            font-size: 30px !important;
            margin: 20px 5px;
            padding: 5px 20px;
            justify-content: center;
        }

        .active {
            display: flex !important;
        }

        .questions.active {
            margin-top: 10px;
        }

        @media (max-width: 768px) {

            .centralContent {
                border: 0;
            }

            #progressBoard {
                padding: 0;
                font-size: 12px;
            }

            #lifeLines {
                width: 140px;
            }

            .progress {
                font-size: inherit;
            }

            .questions {
                font-size: 12px;
            }

            .question {
                font-size: inherit;
            }

            .answer {
                flex: 100%;
            }

            #phoneAfriend h3 {
                margin: 0;
            }

            #phoneAfriend p, #phoneAfriend ul {
                font-size: 10px !important;
                line-height: 14px;
                font-size: 14px;
                margin: 5px 0;
                padding: 0;
            }

            #phoneAfriend li {
                font-size: 10px;
                line-height: 14px;
                margin: 0 0 10px;
            }

            .friends {
                margin: 10px 0;
            }

            .friend {
                width: 100%;
                padding: 5px 5px;
                margin: 2px 0;
            }

            .next, .restart, #playButton, .closeButton {
                margin: 5px auto;
                font-size: 14px;
            }

            .aaQ {
                margin: 0px;
            }

        }
    </style>
</head>
<body>

<div id="splash">
  <div class="split sRight"></div>
  <div class="centralContent">
    <div class="splashBox">
      <h1>Radiobiology: Millionaire Challenge ⚛️</h1>
    </div>
    <h2>Comprehensive Review Game</h2>
    <h4>Includes Radiation Dose Calculations</h4>
    <p>Test your knowledge of cellular effects, dose limits, and solve Equivalent Dose problems!</p>
    <div id="soundSelect">Audio: <span class="on chosen">On</span> / <span class="off">Off</span></div>
    <button id="playButton">Play</button>
  </div>
  <div class="split sLeft"></div>
</div>
<div id="game">
  <div id="progressBoard">
    <div id="lifeLines">
      <div class="lifeLine ll1">50:50</div>
      <div class="lifeLine ll2">Phone a Colleague</div>
      <div class="lifeLine ll3">Ask the Audience</div>
    </div>
    <div id="progressList">
      <div class="progress" v-for="(item, index) in items" :key="index" :key="item.prize">
        <div class="qNum">{{index+1}}</div>
        <div class="prize">${{item.prize}}</div>
      </div>
    </div>
  </div>
  <div id="questionsBoard">

    <div id="infoPanel">
      Select your answer from the 4 choices below
    </div>

    <div id="takeTheMoney">Take the Money</div>

    <div class="questions" v-for="(question) in questions">
      <div class="question">
        {{question.Question}}
      </div>
      <div id="answers">
        <li class="answer A"><div class="questionLetter">A</div>:&nbsp; {{question.A}}</li>
        <li class="answer B"><div class="questionLetter">B</div>:&nbsp; {{question.B}}</li>
        <li class="answer C"><div class="questionLetter">C</div>:&nbsp; {{question.C}}</li>
        <li class="answer D"><div class="questionLetter">D</div>:&nbsp; {{question.D}}</li>
      </div>
      <div class="correctAnswer">{{question.Answer}}</div>
      <div class="answerType">{{question.Type}}</div>
      <div class="answerTypeNumber">{{question.TypeNumber}}</div>

    </div>

    <div id="phoneAfriendBG">
      <div id="phoneAfriend">
        <h3>Select which **Colleague** to call:</h3>
        <p>Choose the colleague who is an expert in the question's category. They have a higher chance of knowing the answer!</p>
        <ul>
          <li><div class="ident ident1"></div>The correct colleague has an 83% chance to know the answer.</li>                            
          <li><div class="ident ident2"></div>The **RSO Fuller (All-Rounder)** is the self-confessed all-around expert, with a 50% chance of knowing even if it's not their field.</li>
          <li><div class="ident ident3"></div>The rest of your colleagues only have a 16% chance of knowing the answer.</li>                            
        </ul>

        <div class="friends">
          <div class="friend friend1">
            <div class="fName">Dr. Gray (Cellular Biologist)</div>
            <div class="fTypeNumber">1</div>
          </div>
          <div class="friend friend2">
            <div class="fName">Physicist Sievert (Units & Quality)</div>
            <div class="fTypeNumber">2</div>
          </div>
          <div class="friend friend3">
            <div class="fName">Mr. RBE (Cellular Interaction)</div>
            <div class="fTypeNumber">5</div>
          </div>
          <div class="friend friend4">
            <div class="fName">Mrs. Limit (Safety & Regulations)</div>
            <div class="fTypeNumber">9</div>
          </div>
          <div class="friend friend5">
            <div class="fName">Dr. TLD (Monitoring Devices)</div>
            <div class="fTypeNumber">4</div>
          </div>
          <div class="friend friend6">
            <div class="fName">Prof. Acute (Syndromes)</div>
            <div class="fTypeNumber">7</div>
          </div>
          <div class="friend friend7">
            <div class="fName">RSO Fuller (All-Rounder)</div>
            <div class="fTypeNumber">99</div> </div>
          <div class="friend friend8">
            <div class="fName">Nurse D-Zero (Cell Survival)</div>
            <div class="fTypeNumber">8</div>
          </div>
        </div>

        <div class="friendInfo"></div>

        <div class="closeButton">Close</div>

      </div>
    </div>

    <div id="askAudienceBG">
      <div id="askAudience">
        <div class="aaQ barA">
          <div class="percentage">0</div>
          <div class="aaBarContainer">
            <div class="aaBars"></div>
          </div>
          <div class="aaLetter">A</div>
        </div>
        <div class="aaQ barA">
          <div class="percentage">0</div>
          <div class="aaBarContainer">
            <div class="aaBars"></div>
          </div>
          <div class="aaLetter">B</div>
        </div>
        <div class="aaQ barC">
          <div class="percentage">0</div>
          <div class="aaBarContainer">
            <div class="aaBars"></div>
          </div>
          <div class="aaLetter">C</div>
        </div>
        <div class="aaQ barD">
          <div class="percentage">0</div>
          <div class="aaBarContainer">
            <div class="aaBars"></div>
          </div>
          <div class="aaLetter">D</div>
        </div>
      </div>
      <div class="closeButton">Close</div>
    </div>
  </div>

</div>
<script type="module">
    // NOTE: This file uses 'import' which requires running in a browser environment that supports ES Modules.
    
    // Start of Audio and Splash Screen Logic (as provided)
    let sound = 1;
    const audioOn = document.querySelector('span.on');
    const audioOff = document.querySelector('span.off');
    const musicAudio = new Audio('https://mwaistell.site/projects/WhoWantsToBeAMillionaire/music4a.mp3');
    musicAudio.volume = 0.2;
    musicAudio.loop = true;

    const correctEasyAnswerAudio = new Audio('https://mwaistell.site/projects/WhoWantsToBeAMillionaire/easyAnswer.mp3');
    correctEasyAnswerAudio.volume = 0.2;
    const correctHardAnswerAudio = new Audio('https://mwaistell.site/projects/WhoWantsToBeAMillionaire/hardAnswer.mp3');
    correctEasyAnswerAudio.volume = 0.2;
    const WrongAnswerAudio = new Audio('https://mwaistell.site/projects/WhoWantsToBeAMillionaire/wrongAnswer.mp3');
    WrongAnswerAudio.volume = 0.2;
    const winAudio = new Audio('https://mwaistell.site/projects/WhoWantsToBeAMillionaire/theWin.mp3');
    winAudio.volume = 0.2;
    const waitAudio = new Audio('https://mwaistell.site/projects/WhoWantsToBeAMillionaire/theWait2.mp3');
    waitAudio.volume = 0.2;
    const audienceAudio = new Audio('https://mwaistell.site/projects/WhoWantsToBeAMillionaire/audience2.mp3');
    audienceAudio.volume = 0.7;
    const fifty50Audio = new Audio('https://mwaistell.site/projects/WhoWantsToBeAMillionaire/5050b.mp3');
    fifty50Audio.volume = 0.7;
    const friendAudio = new Audio('https://mwaistell.site/projects/WhoWantsToBeAMillionaire/friend.mp3');
    friendAudio.volume = 0.3;
    const phoneAudio = new Audio('https://mwaistell.site/projects/WhoWantsToBeAMillionaire/phone.mp3');
    phoneAudio.volume = 0.2;

    audioOn.addEventListener('click', function() {
        sound = 1;
        audioOn.classList.add('chosen');
        audioOff.classList.remove('chosen');
    });

    audioOff.addEventListener('click', function() {
        sound = 0;
        audioOff.classList.add('chosen');
        audioOn.classList.remove('chosen');
    });


    // Start the game
    const splash = document.querySelector('#splash');
    const gameStartButton = document.querySelector('#playButton');
    const splashContainer = document.querySelector('.centralContent');
    const sRight = document.querySelector('.sRight');
    const sLeft = document.querySelector('.sLeft');

    gameStartButton.addEventListener('click', function() {

        sRight.classList.add('animateRight');
        sLeft.classList.add('animateLeft');

        if (sound === 1) {
            musicAudio.play();
        }

        var fadeEffect = setInterval(function () {

            if (!splashContainer.style.opacity) {
                splashContainer.style.opacity = 1;
            }
            if (splashContainer.style.opacity > 0) {
                splashContainer.style.opacity -= 0.1;
            } else {
                clearInterval(fadeEffect);
                setInterval(function () {
                    splash.remove();
                }, 1000);
            }

        }, 100);

    });


    // --- DATA MERGING AND QUESTION GENERATION LOGIC ---

    // 1. Original Question Set (Base)
    const originalQuestions = [
        { "Question": "Which cellular component is considered the most sensitive to radiation damage?", "A": "Mitochondria", "B": "DNA", "C": "Ribosome", "D": "Water", "Answer": "B", "Type": "Cellular Biology", "TypeNumber": 1 },
        { "Question": "Which SI unit is used to measure **Absorbed Dose**?", "A": "Sievert (Sv)", "B": "Becquerel (Bq)", "C": "Coulombs/kg (C/kg)", "D": "Gray (Gy)", "Answer": "D", "Type": "Units & Measurement", "TypeNumber": 2 },
        { "Question": "What is the most radioresistant phase of the cell cycle?", "A": "M phase", "B": "G1 phase", "C": "S phase", "D": "G2 phase", "Answer": "C", "Type": "Cellular Biology", "TypeNumber": 1 },
        { "Question": "The Law of Bergonie and Tribondeau states that tissue radiosensitivity is increased by what factor?", "A": "Increased differentiation of cells", "B": "Increased mitotic activity", "C": "Higher RBE", "D": "Lower LET", "Answer": "B", "Type": "Radiobiology Principles", "TypeNumber": 3 },
        { "Question": "Which radiation monitoring device contains **Lithium Fluoride (LiF)** crystals?", "A": "GM Counter", "B": "OSLs", "C": "Film badges", "D": "TLDs", "Answer": "D", "Type": "Monitoring & Devices", "TypeNumber": 4 },
        { "Question": "An **Indirect Effect** from ionizing radiation primarily occurs on which molecule?", "A": "DNA", "B": "Protein", "C": "H₂O", "D": "Lipid", "Answer": "C", "Type": "Cellular Interaction", "TypeNumber": 5 },
        { "Question": "What is the Quality Factor (QF) for **Alpha Particles**?", "A": "1", "B": "2", "C": "10", "D": "20", "Answer": "D", "Type": "Quality Factors", "TypeNumber": 6 },
        { "Question": "Which phase of the acute radiation syndromes occurs immediately following total body exposure?", "A": "Latent phase", "B": "Prodromal phase", "C": "Manifest phase", "D": "Recovery phase", "Answer": "B", "Type": "Acute Syndromes", "TypeNumber": 7 },
        { "Question": "The variable Dq on a cell survival curve represents which cellular capability?", "A": "Extrapolation number", "B": "Width of the shoulder region (repair)", "C": "Dose after which 37% of cells survive", "D": "Tumor Lethal Dose (TLD)", "Answer": "B", "Type": "Cell Survival Curves", "TypeNumber": 8 },
        { "Question": "What is the whole body annual dose limit for a radiation worker (in SI units)?", "A": "10 mSv/yr", "B": "50 mSv/yr", "C": "150 mSv/yr", "D": "5 Sv/yr", "Answer": "B", "Type": "Safety & Dose Limits", "TypeNumber": 9 },
        { "Question": "What is the formula to calculate a radiation worker's **cumulative** dose limit?", "A": "5 mSv x Age", "B": "50 mSv / Age", "C": "10 mSv x Age", "D": "10 mSv x Years Worked", "Answer": "C", "Type": "Safety & Dose Limits", "TypeNumber": 9 },
        { "Question": "Areas where the dose may exceed **1 mSv per hour** require what sign to be posted?", "A": "Caution—Radioactive Materials", "B": "Caution—Radiation Area", "C": "Caution—High Radiation Area", "D": "Caution—Very High Radiation Area", "Answer": "C", "Type": "Safety & Regulations", "TypeNumber": 4 },
        { "Question": "What is the **TD 5/5** (Tolerance Dose) for the Whole Lens of the Eye?", "A": "10 cGy", "B": "100 cGy", "C": "1,000 cGy (10 Gy)", "D": "4,500 cGy (45 Gy)", "Answer": "C", "Type": "Tolerance Doses", "TypeNumber": 7 },
        { "Question": "Which of the four R's of radiobiology is described by *hypoxic tumor cells becoming more radiosensitive*?", "A": "Repair of sublethal damage", "B": "Reassortment/Redistribution", "C": "Repopulation", "D": "Reoxygenation", "Answer": "D", "Type": "Radiobiology Modifiers", "TypeNumber": 3 },
        { "Question": "The agency that issues licenses to facilities utilizing radiation producing equipment and radioactive isotopes is the:", "A": "NCRP", "B": "ICRP", "C": "NRC", "D": "EPA", "Answer": "C", "Type": "Safety & Regulations", "TypeNumber": 9 }
    ];

    // 2. Source Code Data (Exposure Scenarios for Low Tier)
    const exposureScenarios = [
        { text: "A radiation therapist positioning a patient for LINAC treatment.", category: "Occupational" },
        { text: "A patient undergoing a diagnostic chest X-ray.", category: "Medical" },
        { text: "A person living next door to a hospital with a radiology department.", category: "Public" },
        { text: "A nuclear medicine technologist handling radiopharmaceuticals.", category: "Occupational" },
        { text: "A patient receiving Iodine-131 therapy for thyroid cancer.", category: "Medical" },
        { text: "Someone hiking in the mountains (higher background radiation).", category: "Public" },
        { text: "A researcher working with an unsealed radioactive source in a fume hood.", category: "Occupational" },
        { text: "An airline pilot frequently flying long-haul routes at high altitudes.", category: "Occupational" },
        { text: "A person eating food containing naturally occurring radioactive materials like Potassium-40.", category: "Public" },
        { text: "A volunteer comforting a patient during their PET scan procedure.", category: "Medical" },
        { text: "A worker decommissioning a nuclear facility.", category: "Occupational"},
        { text: "A member of the public near a transport vehicle carrying radioactive materials (incident-free).", category: "Public"}
    ];

    // 3. Source Code Data (Math Logic for High Tier)
    const radiationWeightingFactors = {
        'X-rays': 1,
        'Gamma rays': 1,
        'Beta particles': 1,
        'Alpha particles': 20,
        'Neutrons (thermal)': 2.5,
        'Protons (>2 MeV)': 2
    };

    // --- Helper Functions ---

    function getRandomInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }
    function getRandomFloat(min, max, decimals = 1) { const factor = Math.pow(10, decimals); const value = Math.random() * (max - min) + min; return Math.round(value * factor) / factor; }
    function getRandomElement(arr) { return arr[Math.floor(Math.random() * arr.length)]; }
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    // Helper to randomize static question options
    function randomizeStaticQuestion(q) {
        // Clone to avoid mutating the original reference permanently within one session, 
        // though reloading solves this, it's safer logic.
        let newQ = {...q};
        
        let answers = [
            { text: newQ.A, letter: 'A' },
            { text: newQ.B, letter: 'B' },
            { text: newQ.C, letter: 'C' },
            { text: newQ.D, letter: 'D' }
        ];

        // Identify the correct text
        let correctText = newQ[newQ.Answer]; 

        // Shuffle the array of answer objects
        shuffleArray(answers);

        // Reassign answers to new positions
        newQ.A = answers[0].text;
        newQ.B = answers[1].text;
        newQ.C = answers[2].text;
        newQ.D = answers[3].text;

        // Find where the correct text ended up and update the Answer key
        if (newQ.A === correctText) newQ.Answer = "A";
        else if (newQ.B === correctText) newQ.Answer = "B";
        else if (newQ.C === correctText) newQ.Answer = "C";
        else if (newQ.D === correctText) newQ.Answer = "D";

        return newQ;
    }

    // --- Generation Functions ---

    // Generate Tier 1 (Low $) questions from Scenarios
    function generateScenarioQuestion() {
        const scenario = getRandomElement(exposureScenarios);
        // Determine correct answer letter
        const correctCat = scenario.category;
        
        // Options are fixed for this type
        const opts = [
            { label: "Occupational", val: "Occupational" },
            { label: "Medical", val: "Medical" },
            { label: "Public", val: "Public" },
            { label: "Background/Other", val: "Background" }
        ];
        
        // Assign A, B, C, D randomly
        const shuffledOpts = shuffleArray(opts);
        let correctLetter = "";
        
        const qObj = {
            "Question": "Classify the following exposure scenario: " + scenario.text,
            "Type": "Exposure Categories",
            "TypeNumber": 9 // Use 9 (Safety) for hints
        };

        const letters = ["A", "B", "C", "D"];
        letters.forEach((l, index) => {
            qObj[l] = shuffledOpts[index].label;
            if (shuffledOpts[index].val === correctCat) {
                correctLetter = l;
            }
        });
        qObj["Answer"] = correctLetter;
        return qObj;
    }

    // Generate Tier 3 (High $) questions: Mix of Equivalent Dose & Inverse Square Law
    function generateMathQuestion() {
        // Randomly choose between Question Type 1 (Eq Dose) and Type 2 (Inverse Square)
        const questionType = Math.random() < 0.5 ? "EqDose" : "InvSquare";

        if (questionType === "EqDose") {
            // --- TYPE 1: EQUIVALENT DOSE (H = D * wR) ---
            const radTypes = Object.keys(radiationWeightingFactors);
            const radType = getRandomElement(radTypes);
            const wR = radiationWeightingFactors[radType];
            const absorbedDose = getRandomFloat(0.5, 5.0, 1); // mGy
            const equivalentDose = (absorbedDose * wR).toFixed(2); // mSv
            
            // Distractors
            const d1 = (absorbedDose).toFixed(2); // Forgot wR
            const d2 = (absorbedDose * (wR + 2)).toFixed(2); // Random offset
            const d3 = (absorbedDose / 2).toFixed(2); // Random math error
            
            let answers = [
                { text: equivalentDose + " mSv", correct: true },
                { text: d1 + " mSv", correct: false },
                { text: d2 + " mSv", correct: false },
                { text: d3 + " mSv", correct: false }
            ];
            
            answers = shuffleArray(answers);
            
            let correctLetter = "";
            const qObj = {
                "Question": `Calculate the **Equivalent Dose** if a person receives an Absorbed Dose of **${absorbedDose} mGy** from **${radType}** (wR=${wR}).`,
                "Type": "Dose Calculations",
                "TypeNumber": 2 // Matches "Units" expert
            };

            ["A", "B", "C", "D"].forEach((l, index) => {
                qObj[l] = answers[index].text;
                if (answers[index].correct) correctLetter = l;
            });
            qObj["Answer"] = correctLetter;
            return qObj;

        } else {
            // --- TYPE 2: INVERSE SQUARE LAW (I1/I2 = D2^2/D1^2) ---
            // Formula: I2 = I1 * (D1/D2)^2
            
            // Setup easy numbers for mental math feasibility
            const intensities = [100, 200, 400, 500, 1000]; // mR/hr
            const I1 = getRandomElement(intensities);
            
            // Setup distances that result in clean(ish) numbers
            // Example pairs (d1, d2): (1,2), (2,1), (2,4), (1, 0.5)
            const distancePairs = [
                {d1: 1, d2: 2}, // Double dist -> 1/4 intensity
                {d1: 2, d2: 1}, // Half dist -> 4x intensity
                {d1: 2, d2: 4}, // Double dist -> 1/4 intensity
                {d1: 3, d2: 1}, // 1/3 dist -> 9x intensity
                {d1: 1, d2: 0.5} // Half dist -> 4x intensity
            ];
            const pair = getRandomElement(distancePairs);
            const D1 = pair.d1;
            const D2 = pair.d2;

            // Calculate Correct Answer (I2)
            const I2 = (I1 * Math.pow((D1 / D2), 2)).toFixed(0);

            // Calculate Distractors
            // 1. Inverse Linear (Common mistake: forgetting square) -> I1 * (D1/D2)
            const distInverseLinear = (I1 * (D1 / D2)).toFixed(0);
            
            // 2. Direct Square (Mistaking for Direct Square Law) -> I1 * (D2/D1)^2
            const distDirectSquare = (I1 * Math.pow((D2 / D1), 2)).toFixed(0);
            
            // 3. Random Close Value (I2 +/- 25%)
            const distRandom = (I2 * 1.25).toFixed(0);

            // Ensure unique answers (handle edge cases where formulas overlap)
            let answers = [
                { text: I2 + " mR/hr", correct: true },
                { text: distInverseLinear + " mR/hr", correct: false },
                { text: distDirectSquare + " mR/hr", correct: false },
                { text: distRandom + " mR/hr", correct: false }
            ];

            // Remove duplicates just in case logic produced same numbers
            answers = answers.filter((v,i,a)=>a.findIndex(t=>(t.text === v.text))===i);
            // Fill if we lost any due to duplicates
            while(answers.length < 4) {
                answers.push({ text: (parseInt(answers[0].text) + getRandomInt(10,50)) + " mR/hr", correct: false });
            }
            
            answers = shuffleArray(answers);
            
            let correctLetter = "";
            const qObj = {
                "Question": `**Inverse Square Law**: A source has an intensity of **${I1} mR/hr** at **${D1} meter(s)**. What is the intensity at **${D2} meter(s)**?`,
                "Type": "Inverse Square Law",
                "TypeNumber": 4 // Matches "Monitoring/Safety" expert
            };

            ["A", "B", "C", "D"].forEach((l, index) => {
                qObj[l] = answers[index].text;
                if (answers[index].correct) correctLetter = l;
            });
            qObj["Answer"] = correctLetter;
            return qObj;
        }
    }


    // --- BUILD THE GAME DECK ---

    function buildGameDeck() {
        // Split original questions loosely by difficulty (based on original index)
        // Original 0-4: Easy ($100-$1000)
        // Original 5-9: Medium ($2000-$32000)
        // Original 10-14: Hard ($64k-$1M)
        
        // Process static questions through the randomizer so options shuffle on every load
        const origEasy = originalQuestions.slice(0, 5).map(q => randomizeStaticQuestion(q));
        const origMed = originalQuestions.slice(5, 10).map(q => randomizeStaticQuestion(q));
        const origHard = originalQuestions.slice(10, 15).map(q => randomizeStaticQuestion(q));

        // Create Pool 1: Easy (5 Questions Needed)
        // Mix Original Easy + 5 Generated Scenarios
        let poolEasy = [...origEasy];
        for(let i=0; i<5; i++) poolEasy.push(generateScenarioQuestion());
        poolEasy = shuffleArray(poolEasy);
        
        // Create Pool 2: Medium (5 Questions Needed)
        // Just shuffle the original medium ones for now, or could add more here
        let poolMed = shuffleArray([...origMed]);

        // Create Pool 3: Hard (5 Questions Needed)
        // Mix Original Hard + 5 Generated Math Questions
        let poolHard = [...origHard];
        for(let i=0; i<5; i++) poolHard.push(generateMathQuestion());
        poolHard = shuffleArray(poolHard);

        // Select final 15
        const finalQuestions = [
            ...poolEasy.slice(0, 5),
            ...poolMed.slice(0, 5),
            ...poolHard.slice(0, 5)
        ];

        return finalQuestions;
    }

    // Generate the deck for this session
    const finalGameQuestions = buildGameDeck();

    import { createApp, ref } from 'https://unpkg.com/vue@3/dist/vue.esm-browser.js';

    const app = createApp({
        name: 'Questions',
        data(){
            return{
                // Use the randomly generated deck
                questions: finalGameQuestions, 
                items: [{prize: 100}, {prize: 200}, {prize: 300}, {prize: 500}, {prize: 1000}, {prize: 2000}, {prize: 4000}, {prize: 8000}, {prize: 16000}, {prize: 32000}, {prize: 64000}, {prize: 125000}, {prize: 250000}, {prize: 500000}, {prize: 1000000}]
            }
        },
        state: {
            questionNumber: 0,
        },
        methods: {

            // build the game functionality
            buildGame() {

                let questions = document.querySelectorAll('.questions');
                let questionNumber = 0;
                let prizes = [100, 200, 300, 500, 1000, 2000, 4000, 8000, 16000, 32000, 64000, 125000, 250000, 500000, 1000000];
                // Safe prizes are set at levels 5, 10, and 15 (indices 4, 9, 14)
                let safePrizes = [1000, 32000, 1000000];
                let progress = document.querySelectorAll('.progress');
                let infoPanel = document.querySelector('#infoPanel');
                let safePrize = '$0';
                let nextQuestion;
                let questionDifficulty = 1;
                const takeTheMoneyButton = document.querySelector('#takeTheMoney');
                let randA;
                const pfClose = document.querySelector('#phoneAfriendBG .closeButton');
                const aaClose = document.querySelector('#askAudienceBG .closeButton');

                // Helper for randomiser inside methods
                function randomiser(min, max) {
                    return Math.floor(Math.random() * (max - min + 1)) + min;
                }

                setTimeout(function() {
                    let current = document.querySelector('.progress.active.current');
                    let currentPrize = current.querySelector('.prize').innerHTML;

                    infoPanel.innerHTML = 'For <div class="potentialPrize">' + currentPrize + '</div> select the correct answer from the 4 choices below';
                }, 1);


                // check what the current question should be
                function checkQuestion() {

                    questions.forEach(function(e, i) {
                        if (i == questionNumber) {
                            e.classList.add('active');
                        }
                    });

                };
                checkQuestion();


                // check what progress level the player is at
                function checkProgress() {

                    progress.forEach(function(e, i) {

                        e.classList.add('active');

                        if (e.querySelector('.qNum').innerHTML == questionNumber + 1) {
                            e.classList.add('current');
                        }
                        
                        // Check against the updated safe prize values
                        if (e.querySelector('.prize').innerHTML == '$1000' || e.querySelector('.prize').innerHTML == '$32000' || e.querySelector('.prize').innerHTML == '$1000000') {
                            e.classList.add('safe');
                        }

                    });

                };
                checkProgress();


                // update the game after each correct question answer
                function updateGame() {

                    questionNumber++;
                    questionDifficulty++;

                    let current = document.querySelector('.progress.active.current');
                    let currentPrize = current.querySelector('.prize').innerHTML;
                    current.classList.remove('current');

                    let active = document.querySelector('.questions.active');
                    active.classList.remove('active');

                    takeTheMoneyButton.classList.add('active');

                    checkQuestion();

                    checkProgress();

                    current = document.querySelector('.progress.active.current');
                    currentPrize = current.querySelector('.prize').innerHTML;

                    // 14 is the index for the final question (15th question)
                    if (questionNumber != 14) {
                        infoPanel.innerHTML = 'For <div class="potentialPrize">' + currentPrize + '</div> select the correct answer from the 4 choices below or';
                    } else {
                        infoPanel.innerHTML = 'This is it the final question, for <div class="potentialPrize">' + currentPrize + '</div> Select your answer from the 4 choices below or';
                    }

                };


                // Answer selected functionality
                function answerClick() {

                    questions.forEach(function(q) {

                        let answer = q.querySelectorAll('.answer');
                        let currentQuestion = q.querySelector('.correctAnswer');

                        answer.forEach(function(e, i) {

                            e.addEventListener('click', function() {

                                e.classList.add('clicked');

                                takeTheMoneyButton.classList.remove('active');

                                answer.forEach(function(a, i) {
                                    a.classList.add('disabled');
                                });

                                if (sound === 1) {
                                    waitAudio.play();
                                }

                                setTimeout(function() {

                                    // Check if correct and NOT the final question (index 14)
                                    if (e.querySelector('.questionLetter').innerHTML == currentQuestion.innerHTML && questionNumber != 14) {

                                        e.classList.add('right');

                                        let current = document.querySelector('.progress.current');
                                        current.classList.add('answered');

                                        setTimeout(function() {
                                            if (sound === 1) {
                                                correctEasyAnswerAudio.play();
                                            }
                                        }, 200);

                                        setTimeout(function() {
                                            infoPanel.innerHTML = "Well done that's the correct answer <button class='next'>Next Question</button>";

                                            nextQuestion = document.querySelector('.next');

                                            nextQuestion.addEventListener('click', function() {

                                                updateGame();

                                                answer.forEach(function(a, i) {
                                                    a.classList.remove('disabled');
                                                });

                                            });

                                        }, 1000);

                                        let storeSafePrize = document.querySelector('.progress.safe.current.answered');

                                        if (storeSafePrize) {
                                            safePrize = storeSafePrize.querySelector('.prize').innerHTML;
                                        }

                                        if (sound === 1) {
                                            musicAudio.play();
                                        }

                                    } else if (questionNumber == 14 && e.querySelector('.questionLetter').innerHTML == currentQuestion.innerHTML) {
                                        // Player wins the million! (Index 14)
                                        let current = document.querySelector('.progress.active.current');
                                        let currentPrize = current.querySelector('.prize').innerHTML;
                                        const removeQuestion = document.querySelector('.questions.active');
                                        
                                        // Mark the last question as answered
                                        current.classList.add('answered'); 
                                        
                                        infoPanel.classList.add('bigTakeover');
                                        infoPanel.innerHTML = "Congratulations you've just won <div class='potentialPrize'>" + currentPrize + "</div> Well done. <button class='restart'>Play again</button>";

                                        removeQuestion.remove();

                                        let restartButton = document.querySelector('.restart');
                                        restartButton.addEventListener('click', function() {
                                            history.go(0);
                                        });

                                        if (sound === 1) {
                                            musicAudio.pause();
                                            winAudio.play();
                                        }


                                    } else {
                                        // Wrong Answer

                                        e.classList.add('wrong');
                                        
                                        // Find and highlight the correct answer
                                        answer.forEach(function(a) {
                                            if (a.querySelector('.questionLetter').innerHTML == currentQuestion.innerHTML) {
                                                a.classList.add('right');
                                            }
                                        });

                                        if (sound === 1) {
                                            musicAudio.pause();

                                            setTimeout(function() {
                                                WrongAnswerAudio.play();
                                            }, 200);
                                        }

                                        setTimeout(function() {
                                            infoPanel.innerHTML = "I'm very sorry that's incorrect, you leave with <div class='leaveWith'></div> <button class='restart'>Play again</button>";

                                            let leaveWith = document.querySelector('.leaveWith');
                                            leaveWith.innerHTML = safePrize;

                                            let restartButton = document.querySelector('.restart');
                                            restartButton.addEventListener('click', function() {
                                                history.go(0);
                                            });

                                        }, 5000); 

                                    }

                                }, 5000);


                            });

                        });
                    });

                };
                answerClick();


                // take the money functionality
                function takeTheMoneyClick() {

                    const currentQuestion = document.querySelector('.questions.active');
                    const currentAnswers = currentQuestion.querySelectorAll('.answer');
                    const correctAnswer = currentQuestion.querySelector('.correctAnswer').innerHTML;
                    
                    // Find the previous safe haven prize (answered and safe)
                    const previousSafe = document.querySelector('.progress.answered.safe:not(.current)');
                    const takeHomeValue = previousSafe ? previousSafe.querySelector('.prize').innerHTML : '$0';
                    
                    const lifeLines = document.querySelectorAll('.lifeLine');

                    takeTheMoneyButton.remove();

                    currentAnswers.forEach(function(a, i) {

                        if (a.querySelector('.questionLetter').innerHTML == correctAnswer) {
                            a.classList.add('right');
                        } else {
                            a.classList.add('disabled');
                        }

                    });

                    lifeLines.forEach(function(l, i) {
                        l.classList.add('disabled');
                    });

                    infoPanel.classList.add('bigTakeover');

                    let bigTakeover = document.querySelector('.bigTakeover');
                    bigTakeover.innerHTML = "You chose to take the money, congratulations you leave with <div class='leaveWith'></div> <button class='restart'>Play again</button>";

                    if (questionNumber < 5) {
                        if (sound === 1) {
                            correctEasyAnswerAudio.play();
                        }
                    } else if (questionNumber >= 5 && questionNumber < 10) {
                        if (sound === 1) {
                            correctHardAnswerAudio.play();
                        }
                    } else {
                        if (sound === 1) {
                            winAudio.play();
                        }
                    }

                    const leaveWith = document.querySelector('.leaveWith');
                    leaveWith.innerHTML = takeHomeValue;

                    let restartButton = document.querySelector('.restart');
                    restartButton.addEventListener('click', function() {
                        history.go(0);
                    });

                };

                takeTheMoneyButton.addEventListener('click', function(ttm) {
                    if (questionNumber > 0) { // Only allow taking money after the first question
                        takeTheMoneyClick();
                    }
                });


                // 50/50 funtionality
                function Fifty50() {
                    const lifeLine1 = document.querySelector('.ll1');
                    let llArray = []

                    lifeLine1.addEventListener('click', function(e) {

                        lifeLine1.classList.add('disabled');

                        if (sound === 1) {
                            fifty50Audio.play();
                        }

                        setTimeout(function() {

                            let currentQuestion = document.querySelector('.questions.active');

                            const currentCorrectAnswer = currentQuestion.querySelector('.correctAnswer');
                            const currentAnswers = currentQuestion.querySelectorAll('.answer');

                            currentAnswers.forEach(function(a) {

                                if (a.querySelector('.questionLetter').innerHTML == currentCorrectAnswer.innerHTML) {
                                    a.classList.add('ll1a');
                                }

                            });

                            let rn = randomiser(1, 3);
                            let currentAnswer = currentQuestion.querySelectorAll('.answer:not(.ll1a)');

                            for (let i = 0; i < currentAnswer.length; i++) {

                                if (i + 1 == rn) {
                                    currentAnswer[i].classList.add('ll1b');
                                }

                            };

                            let removeAnswers = currentQuestion.querySelectorAll('.answer:not(.ll1a, .ll1b)');

                            removeAnswers.forEach(function(d) {
                                d.classList.add('disabled');
                            });

                        }, 1700);

                    });
                };
                Fifty50();


                // phone a friend functionality
                function phoneAfriend() {

                    const lifeLine2 = document.querySelector('.ll2');
                    const friends = document.querySelector('.friends');
                    const friend = friends.querySelectorAll('.friend');

                    lifeLine2.addEventListener('click', function(e) {

                        lifeLine2.classList.add('disabled');

                        const currentQuestion = document.querySelector('.questions.active');
                        const correctAnswer = currentQuestion.querySelector('.correctAnswer').innerHTML;
                        const currentAnswers = currentQuestion.querySelectorAll('.answer:not(.disabled)');
                        // Fetch the correct category number from the question data
                        const currentQuestionType = currentQuestion.querySelector('.answerTypeNumber').innerHTML;
                        let friendInfo = document.querySelector('.friendInfo');

                        friend.forEach(function(f) {
                            let fName = f.querySelector('.fName');

                            f.addEventListener('click', function() {

                                if (sound === 1) {
                                    phoneAudio.play();
                                }

                                f.classList.add('selected');

                                friend.forEach(function(fc) {

                                    fc.classList.add('disabled');

                                    if (fc.classList.contains('selected')) {


                                        const fSelectedName = fc.querySelector('.fName').innerHTML;
                                        const fSelectedNumber = fc.querySelector('.fTypeNumber').innerHTML;
                                        const fCorrect = "I believe the answer is <div class='fAnswer'>" + correctAnswer + "</div>";
                                        let answersRest = [];

                                        // Updated randomizer to match the 1-6 range provided in the original friend logic description
                                        randA = randomiser(1, 6);

                                        function friendChance(chance) {
                                            // Original logic: chance 5 (83.33%), chance 3 (50%), chance 1 (16.67%)
                                            if (randA <= chance) {

                                                setTimeout(function() {
                                                    friendInfo.innerHTML = fCorrect;
                                                    highlightFriendsAnswer();
                                                    pfClose.classList.add('active');
                                                }, 2000);

                                            } else {

                                                for (let i = 0; i < currentAnswers.length; i++) {

                                                    if (currentAnswers[i].querySelector('.questionLetter').innerHTML != correctAnswer) {
                                                        answersRest.push(currentAnswers[i].querySelector('.questionLetter').innerHTML);
                                                    }

                                                };
                                                
                                                // Fallback for 50/50 case where only 1 wrong answer remains
                                                if (answersRest.length === 0) {
                                                    var wrongAnswer = correctAnswer;
                                                } else {
                                                    let randomGuess = randomiser(0, answersRest.length - 1);
                                                    var wrongAnswer = answersRest[randomGuess];
                                                }
                                                

                                                const fIncorrect = "I believe the answer is <div class='fAnswer'>" + wrongAnswer + "</div>";

                                                setTimeout(function() {
                                                    friendInfo.innerHTML = fIncorrect;
                                                    highlightFriendsAnswer();
                                                    pfClose.classList.add('active');
                                                }, 2000);

                                            }
                                        };

                                        // All-Rounder RSO Fuller (Number 99 in HTML) gets a 50% chance (3/6)
                                        if (fSelectedNumber == 99) {
                                            friendChance(3);
                                            setTimeout(function() {
                                                fc.classList.add('clicked5050');
                                            }, 2000);
                                        // Expert Colleagues get 83% chance (5/6)
                                        } else if (fSelectedNumber == currentQuestionType) {
                                            friendChance(5);
                                            setTimeout(function() {
                                                fc.classList.add('clickedCorrect');
                                            }, 2000);

                                        } else {
                                            // Non-expert Colleagues get 16% chance (1/6)
                                            friendChance(1);
                                            setTimeout(function() {
                                                fc.classList.add('clickedWrong');
                                            }, 2000);
                                        }


                                        function highlightFriendsAnswer() {

                                            currentAnswers.forEach(function(ca) {

                                                const fAnswer = document.querySelector('.fAnswer');

                                                if (ca.querySelector('.questionLetter').innerHTML == fAnswer.innerHTML) {
                                                    ca.classList.add('friendsAnswer');
                                                }

                                            });

                                        }


                                    } else {
                                        // fc.classList.add('disabled');
                                    }

                                });

                            });

                        });

                        const askAudienceOverlay = document.querySelector('#phoneAfriendBG');
                        askAudienceOverlay.style.display = 'flex';

                    });

                    pfClose.addEventListener('click', function(e) {

                        const askAudienceOverlay = document.querySelector('#phoneAfriendBG');
                        askAudienceOverlay.style.display = 'none';

                        if (sound === 1) {
                            friendAudio.pause();
                            musicAudio.play();
                        }

                    });

                };
                phoneAfriend();


                // ask the audience functionality
                function AskAudience() {
                    let lifeLine3 = document.querySelector('.ll3');

                    lifeLine3.addEventListener('click', function(e) {

                        lifeLine3.classList.add('disabled');

                        const currentQuestion = document.querySelector('.questions.active');
                        let currentAnswer = currentQuestion.querySelectorAll('.answer');
                        const currentCorrectAnswer = currentQuestion.querySelector('.correctAnswer').innerHTML;
                        let aaBars = document.querySelectorAll('.aaQ');

                        currentAnswer.forEach(function(ca, i) {
                            if (ca.classList.contains('disabled')) {
                                aaBars[i].classList.add('disabled');
                            }
                        });

                        let A = 'A';
                        let B = 'B';
                        let C = 'C';
                        let D = 'D';

                        let Anum = 0;
                        let Bnum = 0;
                        let Cnum = 0;
                        let Dnum = 0;

                        let correctLetter;
                        let restLetters = [];
                        let correctNum;
                        let restNum = [];
                        let aaEnabledBars = document.querySelectorAll('.aaQ:not(.disabled)');
                        let aaDisabledBars = document.querySelectorAll('.aaQ.disabled');
                        let aaDisabledLeftOver = 0;

                        if (sound === 1) {
                            audienceAudio.play();
                        }

                        for (let i = 0; i < aaBars.length; ++i) {
                            let barsLetter = aaBars[i].querySelector('.aaLetter');

                            if (barsLetter.innerHTML == currentCorrectAnswer) {
                                correctLetter = barsLetter.innerHTML;
                                correctNum = 0;
                            } else {
                                restLetters.push(barsLetter.innerHTML);
                                restNum.push(0);
                            }

                        }

                        for (let i = 0; i < 100; i++) {
                            // Use questionDifficulty to make correct bar harder on later questions
                            if (questionDifficulty <= 2) {
                                randA = randomiser(1, 7);
                            } else if (questionDifficulty > 2 && questionDifficulty <= 7) {
                                randA = randomiser(1, 6);
                            } else if (questionDifficulty > 7 && questionDifficulty < 11) {
                                randA = randomiser(1, 5);
                            } else {
                                randA = randomiser(1, 4.2);
                            }


                            if (randA == 1) {
                                restNum[0]++;
                            } else if (randA == 2) {
                                restNum[1]++;
                            } else if (randA == 3) {
                                restNum[2]++;
                            } else {
                                correctNum++;
                            }

                        }

                        aaBars.forEach(function(cb){

                            let aaBarLetter = cb.querySelector('.aaLetter');
                            let aaBar = cb.querySelector('.aaBars');
                            let aaPercentage = cb.querySelector('.percentage');

                            for (let i = 0; i < restLetters.length; i++) {

                                if (aaBarLetter.innerHTML == restLetters[i]) {

                                    if (cb.classList.contains('disabled')) {
                                        aaDisabledLeftOver = aaDisabledLeftOver + restNum[i];

                                        aaPercentage.innerHTML = 0;
                                        aaBar.style.height = 0;
                                    }

                                    if (!cb.classList.contains('disabled')) {

                                        setTimeout(function() {
                                            aaBar.style.height = restNum[i] + '%';
                                            aaPercentage.innerHTML = restNum[i];
                                        }, 4000);

                                    }

                                }

                            }

                            if (aaBarLetter.innerHTML == correctLetter) {

                                setTimeout(function() {
                                    correctNum = correctNum + aaDisabledLeftOver;

                                    aaBar.style.height = correctNum + '%';
                                    aaPercentage.innerHTML = correctNum;
                                }, 4000);


                            }

                        });

                        setTimeout(function() {
                            aaClose.classList.add('active');
                        }, 5000);

                        const askAudienceOverlay = document.querySelector('#askAudienceBG');
                        askAudienceOverlay.style.display = 'flex';

                    });


                    aaClose.addEventListener('click', function(e) {

                        const askAudienceOverlay = document.querySelector('#askAudienceBG');
                        askAudienceOverlay.style.display = 'none';

                    });
                };
                AskAudience();

            },

        },
        mounted() {

            // build the game once everything is mounted
            this.buildGame()

        }

    }).mount('#game');
</script>
</body>
</html>
