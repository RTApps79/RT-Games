<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>LINAC Console Emulator - Two Monitor Enhanced</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<header>LINAC Control Console Emulator</header>
<div class="container">
  <!-- EMR Panel (left monitor) -->
  <div class="panel emr-panel">
    <h3>Patient EMR</h3>
    <div class="emr-tabs">
        <button class="tab-button active" onclick="showTab('demographics')">Demographics</button>
        <button class="tab-button" onclick="showTab('treatment')">Treatment</button>
        <button class="tab-button" onclick="showTab('labs')">Labs</button>
    </div>
    <div class="tab-content active" id="demographics">
        <p><strong>Name:</strong> <span id="patientName">---</span></p>
        <p><strong>DOB:</strong> <span id="patientDOB">---</span></p>
        <p><strong>Diagnosis:</strong> <span id="patientDiagnosis">---</span></p>
        <p><strong>Patient Type:</strong> <span id="patientType">---</span></p>
        <button id="generateCaseBtn" style="margin-top: 15px; padding: 8px;">Generate New Patient Case</button>
    </div>
    <div class="tab-content" id="treatment">
        <p>Generate a new patient case to see the treatment plan.</p>
    </div>
    <div class="tab-content" id="labs">
        <p><strong>Creatinine:</strong> <span id="labCreat">---</span></p>
        <p><strong>WBC:</strong> <span id="labWBC">---</span></p>
    </div>
  </div>
  <!-- Main (right monitor) -->
  <div class="main-panel">
    <!-- QA & Interlocks + Status Bar -->
    <div class="qa-status-bar">
      <div class="qa-interlocks-panel horizontal">
        <span class="interlock-status ok" id="interlock-door"><span class="interlock-dot" id="dot-door"></span>Door: <span id="doorStatus">Closed</span></span>
        <span class="interlock-status ok" id="interlock-beam"><span class="interlock-dot" id="dot-beam"></span>Beam: <span id="beamStatus">Off</span></span>
        <span class="interlock-status ok" id="interlock-override"><span class="interlock-dot" id="dot-override"></span>Override: <span id="overrideStatus">Inactive</span></span>
        <span class="qa-checklist">
          <label><input type="checkbox" disabled checked> Imaging</label>
          <label><input type="checkbox" disabled> Field Verified</label>
          <label><input type="checkbox" disabled> Rx Matched</label>
        </span>
      </div>
      <div class="status-bar-local" id="local-status-bar">Emulator Ready. Generate a patient case.</div>
    </div>
    <div class="monitors-row">
      <!-- Machine Parameters + Field Visualizer + DRR + MLC controls -->
      <div class="monitor-screen monitor-parameters-mlc">
        <h2>Machine Parameters</h2>
        <div class="machine-param-box-group">
          <div class="machine-param-box"><span class="param-label">Beam</span><span id="mp-energy">6 MV</span></div>
          <div class="machine-param-box"><span class="param-label">Collimator</span><span id="mp-collimator">0°</span></div>
        </div>
        <div class="machine-param-box-group field-dims-group">
          <div class="machine-param-box"><span class="param-label">Gantry</span><span id="mp-gantry">0°</span></div>
          <div class="machine-param-box"><span class="param-label">Couch</span><span id="mp-couch">0°</span></div>
        </div>
        <div class="machine-param-box-group jaws-group" style="margin-bottom:0.6em;">
          <div class="machine-param-box"><span class="param-label">X1</span><span id="jawX1">5.0</span></div>
          <div class="machine-param-box"><span class="param-label">X2</span><span id="jawX2">5.0</span></div>
          <div class="machine-param-box"><span class="param-label">Y1</span><span id="jawY1">5.0</span></div>
          <div class="machine-param-box"><span class="param-label">Y2</span><span id="jawY2">5.0</span></div>
        </div>
        <!-- Enhanced Field/MLC Visualizer with DRR -->
        <div class="mlc-visualizer-block">
          <h3>Field/MLC Visualizer &amp; DRR</h3>
          <div id="fieldDisplayContainer">
            <div id="rotatingElementsContainer">
              <div id="fieldDisplayRect"></div>
            </div>
          </div>
          <div class="summary-text" style="margin-top:10px;">
            Field: <span id="totalFieldX">10.0</span> x <span id="totalFieldY">10.0</span> cm |
            Collimator: <span id="collimatorDisplay">0°</span>
          </div>
        </div>
        <!-- DRR & visualizer controls -->
        <div class="drr-mlc-controls-block">
          <div class="control-group image-controls" style="margin-bottom:8px;">
            <label for="drrImageSelect" style="font-weight:bold;">DRR Image:</label>
            <select id="drrImageSelect" style="width: 180px;">
                <option value="">-- None --</option>
                <option value="https://prod-images-static.radiopaedia.org/images/2089213/f12063879a29e672f675977fabdc89_gallery.jpeg">Chest AP</option>
                <option value="https://prod-images-static.radiopaedia.org/images/13205453/221b52a9fd6ca1675dccde4728534d_big_gallery.jpg">Brain Lat</option>
                <option value="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRcK9oD-R3O3Nt7FQeUZ_jAjfws1z48JyKQcA&s">Pelvis AP</option>
                <option value="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ6AdTnLxJ_MVHgTFu27PNRV-P62fjSKoFvBQ&s">Spine AP</option>
            </select>
          </div>
          <div class="control-group field-size-controls" style="margin-bottom:8px;">
            <div class="control-row">
                <div class="control-item"><label>X1:</label><button onclick="changeFieldSize('X1', -0.5)">–</button><span class="control-display" id="control-jawX1">5.0</span><button onclick="changeFieldSize('X1', 0.5)">+</button></div>
                <div class="control-item"><label>X2:</label><button onclick="changeFieldSize('X2', -0.5)">–</button><span class="control-display" id="control-jawX2">5.0</span><button onclick="changeFieldSize('X2', 0.5)">+</button></div>
            </div>
            <div class="control-row">
                <div class="control-item"><label>Y1:</label><button onclick="changeFieldSize('Y1', -0.5)">–</button><span class="control-display" id="control-jawY1">5.0</span><button onclick="changeFieldSize('Y1', 0.5)">+</button></div>
                <div class="control-item"><label>Y2:</label><button onclick="changeFieldSize('Y2', -0.5)">–</button><span class="control-display" id="control-jawY2">5.0</span><button onclick="changeFieldSize('Y2', 0.5)">+</button></div>
            </div>
          </div>
          <div class="control-group collimator-controls" style="margin-bottom:8px;">
            <div class="control-row">
                <div class="control-item"><button id="collRotateNegBtn">– 5°</button><span class="control-display" id="collimatorDisplay2">0°</span><button id="collRotatePosBtn">+ 5°</button></div>
            </div>
          </div>
          <div class="control-group mlc-controls">
            <div class="mlc-preset-controls">
                <button id="presetMatchJaw">Match Jaws</button>
                <button id="presetMultiBlock">Multi-Block</button>
                <button id="presetSquare">Square</button>
                <button id="presetOffset">Offset</button>
                <button id="presetBlock">Block</button>
                <button id="presetCshape">C-Shape</button>
                <button id="presetDiagonal">Diagonal</button>
                <button id="presetDiagRev">Rev Diag</button>
                <button id="presetDiagShallow">Shallow</button>
                <button id="animateSquareRandBtn">Animate Square</button>
                <button id="animateOffsetRandBtn">Animate Offset</button>
                <button id="animateDiagonalRandBtn">Animate Diagonal</button>
                <button id="slidingWindowBtn">Sliding Window</button>
                <button id="imrtDemoBtn">IMRT Demo</button>
            </div>
          </div>
        </div>
      </div>
      <!-- Image Alignment remains as second monitor -->
      <div class="monitor-screen monitor-alignment">
        <h2>Image Alignment</h2>
        <div class="overlay-container focal">
          <img src="https://via.placeholder.com/400x320.png?text=Base+(Load+Case)" class="base-image" id="baseImage" alt="Base Patient Anatomy">
          <img src="https://via.placeholder.com/400x320.png?text=Overlay+(Load+Case)" id="overlayImage" class="overlay-image" alt="Overlay Reference Image">
        </div>
        <div class="compact-image-controls">
          <button onclick="moveOverlay(0,-1)" title="Up">↑</button>
          <button onclick="moveOverlay(-1,0)" title="Left">←</button>
          <button onclick="moveOverlay(1,0)" title="Right">→</button>
          <button onclick="moveOverlay(0,1)" title="Down">↓</button>
          <button onclick="rotateOverlay(-1)" title="Rotate Left">↺</button>
          <span id="rotationDisplay" class="mini-label">0°</span>
          <button onclick="rotateOverlay(1)" title="Rotate Right">↻</button>
          <button onclick="scaleOverlay(false)" title="Zoom Out">-</button>
          <span id="scaleDisplay" class="mini-label">1.00x</span>
          <button onclick="scaleOverlay(true)" title="Zoom In">+</button>
          <input type="range" id="opacitySlider" min="0" max="100" value="50" style="width:70px;vertical-align:middle;" title="Opacity"/>
          <span id="opacityValue" class="mini-label">50%</span>
        </div>
        <div class="motion-readout">
          <strong>Couch Shift:</strong>
          X: <span id="couchShiftX">0</span> px,
          Y: <span id="couchShiftY">0</span> px,
          <strong>Rotation:</strong>
          <span id="couchRotation">0°</span>,
          <strong>Zoom:</strong>
          <span id="couchZoom">1.00x</span>
        </div>
        <p id="alignmentMessage" style="text-align: center;"></p>
        <p id="shiftFeedback" style="color: orange; min-height: 1em; text-align: center;"></p>
        <p id="alignmentCounterDisplay" style="text-align: center; font-weight: bold; margin-top: 5px;">Correct Case Alignments: 0</p>
      </div>
    </div>
    <!-- Console controls below -->
    <div class="console-panel-group">
      <div class="console-buttons">
        <button id="energyToggleButton" class="console-button">Set Energy</button>
        <span class="field-size-display" id="currentEnergyDisplay" style="min-width: 80px; text-align: center;">6 MV</span>
        <button class="console-button" id="btn-set-mu">Set MU</button>
        <button id="btn-conesize" class="console-button disabled">Electron Cone</button>
        <button class="console-button disabled" id="btn-prepare">Prepare</button>
        <button class="console-button beam-on disabled" id="btn-beam-on">Beam On</button>
        <button class="console-button beam-off disabled" id="btn-beam-off">Beam Off</button>
        <button class="console-button" id="btn-reset">Reset State</button>
        <button class="console-button door-control" id="btn-door-control">Open Door</button>
        <button class="console-button disabled" id="btn-override">Override</button>
      </div>
      <div id="console-display">
        <div id="console-parameters">Energy: 6 MV | MU: 000 | Field: ---x--- </div>
        <div id="console-status">Status: Idle</div>
        <div id="console-reading">Delivered MU: 000 | Dose Rate: ---</div>
      </div>
    </div>
  </div>
</div>
<script src="script.js"></script>
</body>
</html>
